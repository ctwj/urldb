# urlDB JavaScriptæ’ä»¶ç³»ç»Ÿè¯¦ç»†æ–¹æ¡ˆ

## 1. æ–¹æ¡ˆæ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯

éšç€urlDBç³»ç»Ÿçš„å‘å±•ï¼Œå¯¹æ’ä»¶å¼€å‘æ•ˆç‡çš„è¦æ±‚è¶Šæ¥è¶Šé«˜ã€‚å½“å‰çš„Goæ’ä»¶ç³»ç»Ÿè™½ç„¶ç¨³å®šå¯é ï¼Œä½†å­˜åœ¨ä»¥ä¸‹ç—›ç‚¹ï¼š

- **å­¦ä¹ æˆæœ¬é«˜**ï¼šéœ€è¦æŒæ¡Goè¯­è¨€å’Œç¼–è¯‘æµç¨‹
- **å¼€å‘å‘¨æœŸé•¿**ï¼šç¼–è¯‘ã€éƒ¨ç½²æµç¨‹ç›¸å¯¹ç¹ç
- **è°ƒè¯•å›°éš¾**ï¼šéœ€è¦é‡æ–°ç¼–è¯‘æ‰èƒ½æµ‹è¯•ä¿®æ”¹
- **ç”Ÿæ€é™åˆ¶**ï¼šæ— æ³•åˆ©ç”¨JavaScriptä¸°å¯Œçš„ç”Ÿæ€ç³»ç»Ÿ

### 1.2 æ–¹æ¡ˆç›®æ ‡

æœ¬æ–¹æ¡ˆæ—¨åœ¨ä¸ºurlDBç³»ç»Ÿå¼•å…¥JavaScriptæ’ä»¶æ”¯æŒï¼Œå®ç°ä»¥ä¸‹ç›®æ ‡ï¼š

#### **ä¸»è¦ç›®æ ‡**
- âœ… **æå‡å¼€å‘æ•ˆç‡**ï¼šJavaScriptè¯­æ³•ç®€æ´ï¼Œå¼€å‘é€Ÿåº¦å¿«
- âœ… **é™ä½å­¦ä¹ é—¨æ§›**ï¼šå‰ç«¯å¼€å‘è€…å¯ä»¥å¿«é€Ÿä¸Šæ‰‹
- âœ… **æ”¯æŒçƒ­é‡è½½**ï¼šå¼€å‘æ—¶æ— éœ€é‡å¯å³å¯çœ‹åˆ°æ•ˆæœ
- âœ… **åˆ©ç”¨JSç”Ÿæ€**ï¼šå¯ä»¥ä½¿ç”¨npmåŒ…å’ŒJavaScriptå·¥å…·é“¾
- âœ… **ä¿æŒå…¼å®¹æ€§**ï¼šä¸ç°æœ‰Goæ’ä»¶ç³»ç»Ÿå®Œå…¨å…¼å®¹

#### **æ¬¡è¦ç›®æ ‡**
- ğŸ”„ **æ¸è¿›å¼è¿ç§»**ï¼šæ”¯æŒä»Goæ’ä»¶é€æ­¥è¿ç§»åˆ°JSæ’ä»¶
- ğŸ›¡ï¸ **å®‰å…¨æ§åˆ¶**ï¼šæä¾›æ²™ç®±ç¯å¢ƒå’Œæƒé™ç®¡ç†
- ğŸ“Š **ç›‘æ§é›†æˆ**ï¼šä¸ç°æœ‰ç›‘æ§ç³»ç»Ÿæ— ç¼é›†æˆ
- ğŸ§ª **æµ‹è¯•å‹å¥½**ï¼šæä¾›å®Œæ•´çš„æµ‹è¯•å’Œè°ƒè¯•å·¥å…·

### 1.3 è®¾è®¡åŸåˆ™

1. **ç®€å•ä¼˜å…ˆ**ï¼šé¿å…è¿‡åº¦è®¾è®¡ï¼Œä¿æŒæ¶æ„ç®€æ´
2. **æ¸è¿›å¢å¼º**ï¼šä»åŸºç¡€åŠŸèƒ½å¼€å§‹ï¼Œé€æ­¥å®Œå–„
3. **å‘åå…¼å®¹**ï¼šä¸ç ´åç°æœ‰Goæ’ä»¶ç³»ç»Ÿ
4. **å®‰å…¨å¯æ§**ï¼šæä¾›å¿…è¦çš„å®‰å…¨é˜²æŠ¤æœºåˆ¶
5. **æ€§èƒ½å¹³è¡¡**ï¼šåœ¨å¼€å‘æ•ˆç‡å’Œè¿è¡Œæ€§èƒ½é—´æ‰¾åˆ°å¹³è¡¡

## 2. æ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    urlDB ä¸»ç³»ç»Ÿ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              Plugin Manager (ç»Ÿä¸€æ’ä»¶ç®¡ç†å™¨)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Go Plugin Loader   â”‚   JS Plugin Bridge (æ–°å¢)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Go Plugins         â”‚   JavaScript Plugins (æ–°å¢)          â”‚
â”‚  - builtin.so       â”‚   - notification.js                   â”‚
â”‚  - analytics.so     â”‚   - webhook.js                        â”‚
â”‚                     â”‚   - custom-handler.js                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒç»„ä»¶

#### **2.2.1 JS Bridge Pluginï¼ˆæ ¸å¿ƒæ¡¥æ¥å™¨ï¼‰**

```go
type JSBridgePlugin struct {
    name        string
    version     string
    scriptPath  string
    vm          *goja.Runtime
    context     PluginContext
    hooks       map[string]func() error
    initialized bool
    config      map[string]interface{}
    timeout     time.Duration
}
```

**èŒè´£ï¼š**
- å®ç°Goæ’ä»¶æ¥å£ï¼Œæ— ç¼é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿ
- ç®¡ç†JavaScriptè¿è¡Œæ—¶ç¯å¢ƒ
- æä¾›Goä¸JavaScriptä¹‹é—´çš„APIæ¡¥æ¥
- å¤„ç†æ’ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†

#### **2.2.2 JavaScript Runtime Managerï¼ˆè¿è¡Œæ—¶ç®¡ç†å™¨ï¼‰**

```go
type JSRuntimeManager struct {
    vmPool      sync.Pool
    maxVMs      int
    activeVMs   int32
    timeout     time.Duration
    memoryLimit int64
}
```

**èŒè´£ï¼š**
- ç®¡ç†JavaScriptè™šæ‹Ÿæœºæ± 
- æ§åˆ¶èµ„æºä½¿ç”¨å’Œè¶…æ—¶
- æä¾›è¿è¡Œæ—¶å®‰å…¨éš”ç¦»

#### **2.2.3 API Binderï¼ˆAPIç»‘å®šå™¨ï¼‰**

```go
type APIBinder struct {
    context PluginContext
    vm      *goja.Runtime
    funcs   map[string]interface{}
}
```

**èŒè´£ï¼š**
- å°†Go APIæš´éœ²ç»™JavaScriptç¯å¢ƒ
- å¤„ç†æ•°æ®ç±»å‹è½¬æ¢
- æä¾›ç»Ÿä¸€çš„APIè°ƒç”¨æ¥å£

#### **2.2.4 Hook Systemï¼ˆé’©å­ç³»ç»Ÿï¼‰**

```go
type HookSystem struct {
    hooks map[string][]func() error
    order map[string]int
}
```

**èŒè´£ï¼š**
- ç®¡ç†æ’ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­
- æ”¯æŒäº‹ä»¶ç›‘å¬å’Œå¤„ç†
- æä¾›é’©å­æ‰§è¡Œé¡ºåºæ§åˆ¶

### 2.3 JavaScriptæ’ä»¶æ¥å£è®¾è®¡

#### **2.3.1 åŸºç¡€æ’ä»¶ç»“æ„**

```javascript
// JavaScriptæ’ä»¶æ ‡å‡†ç»“æ„
const plugin = {
    // åŸºæœ¬ä¿¡æ¯
    name: "example-plugin",
    version: "1.0.0",
    description: "ç¤ºä¾‹JavaScriptæ’ä»¶",
    author: "urlDB Team",

    // ç”Ÿå‘½å‘¨æœŸé’©å­
    onInit: function() {
        log("info", "Plugin initializing...");
    },

    onStart: function() {
        log("info", "Plugin starting...");

        // è¯»å–é…ç½®
        const config = getConfig("api_url");
        log("info", "API URL: " + config);

        // è®¾ç½®æ•°æ®
        setData("status", "running");
    },

    onStop: function() {
        log("info", "Plugin stopping...");
        setData("status", "stopped");
    },

    onCleanup: function() {
        log("info", "Plugin cleaning up...");
    }
};

// æ³¨å†Œæ’ä»¶
registerPlugin(plugin);
```

#### **2.3.2 å¯ç”¨APIåˆ—è¡¨**

```javascript
// æ—¥å¿—API
log(level, message)  // level: "debug", "info", "warn", "error"

// é…ç½®API
getConfig(key)       // è·å–é…ç½®å€¼
setConfig(key, value) // è®¾ç½®é…ç½®å€¼

// æ•°æ®API
getData(key, type)   // è·å–æ•°æ®ï¼Œtype: "string", "json", "number"
setData(key, value, type) // è®¾ç½®æ•°æ®
deleteData(key, type)     // åˆ é™¤æ•°æ®

// ä»»åŠ¡API
registerTask(name, function) // æ³¨å†Œå®šæ—¶ä»»åŠ¡
unregisterTask(name)         // å–æ¶ˆä»»åŠ¡

// æ•°æ®åº“APIï¼ˆå—é™è®¿é—®ï¼‰
dbFind(table, query)     // æŸ¥è¯¢æ•°æ®
dbSave(table, data)      // ä¿å­˜æ•°æ®
dbUpdate(table, id, data) // æ›´æ–°æ•°æ®
dbDelete(table, id)      // åˆ é™¤æ•°æ®

// HTTP API
httpGet(url, headers)    // å‘é€GETè¯·æ±‚
httpPost(url, data, headers) // å‘é€POSTè¯·æ±‚

// ç¼“å­˜API
cacheSet(key, value, ttl)    // è®¾ç½®ç¼“å­˜
cacheGet(key)                // è·å–ç¼“å­˜
cacheDelete(key)             // åˆ é™¤ç¼“å­˜

// äº‹ä»¶API
on(event, handler)       // ç›‘å¬äº‹ä»¶
emit(event, data)        // è§¦å‘äº‹ä»¶
off(event, handler)      // å–æ¶ˆç›‘å¬
```

## 3. å®ç°æ–¹æ¡ˆ

### 3.1 ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¡†æ¶ï¼ˆ2-3å‘¨ï¼‰

#### **3.1.1 æ·»åŠ ä¾èµ–**

```go
// go.mod
require (
    github.com/dop251/goja v0.0.0-20231015150820-d2a4c1d2b06e
    github.com/dop251/goja_nodejs v0.0.0-20230929181953-6c5b9c2c1c9e
)
```

#### **3.1.2 æ ¸å¿ƒå®ç°**

**JSBridgePluginå®ç°ï¼š**

```go
// plugin/js/js_bridge_plugin.go
package js

import (
    "context"
    "encoding/json"
    "fmt"
    "io/ioutil"
    "time"

    "github.com/dop251/goja"
    "github.com/ctwj/urldb/plugin/types"
    "github.com/ctwj/urldb/utils"
)

type JSBridgePlugin struct {
    name        string
    version     string
    scriptPath  string
    vm          *goja.Runtime
    context     types.PluginContext
    hooks       map[string]func() error
    initialized bool
    config      map[string]interface{}
    timeout     time.Duration
}

func NewJSBridgePlugin(name, scriptPath string) *JSBridgePlugin {
    return &JSBridgePlugin{
        name:       name,
        scriptPath: scriptPath,
        hooks:      make(map[string]func() error),
        timeout:    30 * time.Second, // é»˜è®¤30ç§’è¶…æ—¶
    }
}

// å®ç°Pluginæ¥å£
func (p *JSBridgePlugin) Name() string { return p.name }
func (p *JSBridgePlugin) Version() string { return p.version }
func (p *JSBridgePlugin) Description() string {
    return fmt.Sprintf("JavaScript plugin from %s", p.scriptPath)
}
func (p *JSBridgePlugin) Author() string { return "JavaScript Developer" }
func (p *JSBridgePlugin) Dependencies() []string { return []string{} }
func (p *JSBridgePlugin) CheckDependencies() map[string]bool { return map[string]bool{} }

func (p *JSBridgePlugin) Initialize(ctx types.PluginContext) error {
    p.context = ctx
    p.vm = goja.New()

    // ç»‘å®šAPIåˆ°JavaScriptç¯å¢ƒ
    if err := p.bindAPIs(); err != nil {
        return fmt.Errorf("failed to bind APIs: %v", err)
    }

    // åŠ è½½å¹¶æ‰§è¡ŒJavaScriptè„šæœ¬
    if err := p.loadScript(); err != nil {
        return fmt.Errorf("failed to load script: %v", err)
    }

    p.initialized = true
    ctx.LogInfo("JavaScript plugin %s initialized successfully", p.name)
    return nil
}

func (p *JSBridgePlugin) bindAPIs() error {
    binder := NewAPIBinder(p.context, p.vm)
    return binder.BindAll()
}

func (p *JSBridgePlugin) loadScript() error {
    scriptData, err := ioutil.ReadFile(p.scriptPath)
    if err != nil {
        return fmt.Errorf("failed to read script file: %v", err)
    }

    // åˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œæ”¯æŒè¶…æ—¶æ§åˆ¶
    ctx, cancel := context.WithTimeout(context.Background(), p.timeout)
    defer cancel()

    // æ‰§è¡Œè„šæœ¬
    _, err = p.vm.RunString(string(scriptData))
    if err != nil {
        return fmt.Errorf("script execution error: %v", err)
    }

    return nil
}

func (p *JSBridgePlugin) Start() error {
    if hook, exists := p.hooks["start"]; exists {
        return p.executeHook("start", hook)
    }
    return nil
}

func (p *JSBridgePlugin) Stop() error {
    if hook, exists := p.hooks["stop"]; exists {
        return p.executeHook("stop", hook)
    }
    return nil
}

func (p *JSBridgePlugin) Cleanup() error {
    if hook, exists := p.hooks["cleanup"]; exists {
        return p.executeHook("cleanup", hook)
    }

    // æ¸…ç†VMèµ„æº
    if p.vm != nil {
        p.vm = nil
    }

    return nil
}

func (p *JSBridgePlugin) executeHook(name string, hook func() error) error {
    p.context.LogInfo("Executing hook: %s", name)

    start := time.Now()
    err := hook()
    duration := time.Since(start)

    if err != nil {
        p.context.LogError("Hook %s failed after %v: %v", name, duration, err)
        return err
    }

    p.context.LogInfo("Hook %s completed successfully in %v", name, duration)
    return nil
}
```

**API Binderå®ç°ï¼š**

```go
// plugin/js/api_binder.go
package js

import (
    "encoding/json"
    "fmt"
    "time"

    "github.com/dop251/goja"
    "github.com/ctwj/urldb/plugin/types"
    "github.com/ctwj/urldb/utils"
)

type APIBinder struct {
    context types.PluginContext
    vm      *goja.Runtime
}

func NewAPIBinder(context types.PluginContext, vm *goja.Runtime) *APIBinder {
    return &APIBinder{
        context: context,
        vm:      vm,
    }
}

func (b *APIBinder) BindAll() error {
    // ç»‘å®šæ—¥å¿—API
    b.bindLogAPI()

    // ç»‘å®šé…ç½®API
    b.bindConfigAPI()

    // ç»‘å®šæ•°æ®API
    b.bindDataAPI()

    // ç»‘å®šé’©å­æ³¨å†ŒAPI
    b.bindHookAPI()

    // ç»‘å®šHTTP API
    b.bindHTTPAPI()

    // ç»‘å®šå·¥å…·API
    b.bindUtilityAPI()

    return nil
}

func (b *APIBinder) bindLogAPI() {
    b.vm.Set("log", func(level, message string) {
        switch level {
        case "debug":
            b.context.LogDebug(message)
        case "info":
            b.context.LogInfo(message)
        case "warn":
            b.context.LogWarn(message)
        case "error":
            b.context.LogError(message)
        default:
            b.context.LogInfo(message)
        }
    })
}

func (b *APIBinder) bindConfigAPI() {
    b.vm.Set("getConfig", func(key string) goja.Value {
        val, err := b.context.GetConfig(key)
        if err != nil {
            b.context.LogError("Failed to get config %s: %v", key, err)
            return b.vm.ToValue(nil)
        }
        return b.vm.ToValue(val)
    })

    b.vm.Set("setConfig", func(key string, value goja.Value) error {
        return b.context.SetConfig(key, value.Export())
    })
}

func (b *APIBinder) bindDataAPI() {
    b.vm.Set("getData", func(key, dataType string) goja.Value {
        val, err := b.context.GetData(key, dataType)
        if err != nil {
            b.context.LogError("Failed to get data %s: %v", key, err)
            return b.vm.ToValue(nil)
        }
        return b.vm.ToValue(val)
    })

    b.vm.Set("setData", func(key string, value goja.Value, dataType string) error {
        return b.context.SetData(key, value.Export(), dataType)
    })

    b.vm.Set("deleteData", func(key, dataType string) error {
        return b.context.DeleteData(key, dataType)
    })
}

func (b *APIBinder) bindHookAPI() {
    // è·å–JSBridgePluginå®ä¾‹æ¥æ³¨å†Œé’©å­
    plugin := b.getPluginInstance()
    if plugin == nil {
        return
    }

    b.vm.Set("onInit", func(fn goja.Value) {
        if goja.IsFunction(fn) {
            plugin.hooks["init"] = func() error {
                _, err := b.vm.CallFunction(fn.(goja.Callable), nil)
                return err
            }
        }
    })

    b.vm.Set("onStart", func(fn goja.Value) {
        if goja.IsFunction(fn) {
            plugin.hooks["start"] = func() error {
                _, err := b.vm.CallFunction(fn.(goja.Callable), nil)
                return err
            }
        }
    })

    b.vm.Set("onStop", func(fn goja.Value) {
        if goja.IsFunction(fn) {
            plugin.hooks["stop"] = func() error {
                _, err := b.vm.CallFunction(fn.(goja.Callable), nil)
                return err
            }
        }
    })

    b.vm.Set("onCleanup", func(fn goja.Value) {
        if goja.IsFunction(fn) {
            plugin.hooks["cleanup"] = func() error {
                _, err := b.vm.CallFunction(fn.(goja.Callable), nil)
                return err
            }
        }
    })
}

func (b *APIBinder) bindHTTPAPI() {
    b.vm.Set("httpGet", func(url string, headers goja.Value) goja.Value {
        // å®ç°HTTP GETè¯·æ±‚
        // è¿™é‡Œç®€åŒ–å®ç°ï¼Œå®é™…åº”è¯¥ä½¿ç”¨http.Client
        result := map[string]interface{}{
            "status": 200,
            "body":   "Mock response for GET " + url,
            "headers": map[string]string{},
        }
        return b.vm.ToValue(result)
    })

    b.vm.Set("httpPost", func(url string, data goja.Value, headers goja.Value) goja.Value {
        // å®ç°HTTP POSTè¯·æ±‚
        result := map[string]interface{}{
            "status": 200,
            "body":   "Mock response for POST " + url,
            "headers": map[string]string{},
        }
        return b.vm.ToValue(result)
    })
}

func (b *APIBinder) bindUtilityAPI() {
    b.vm.Set("jsonParse", func(str string) goja.Value {
        var result interface{}
        if err := json.Unmarshal([]byte(str), &result); err != nil {
            return b.vm.ToValue(nil)
        }
        return b.vm.ToValue(result)
    })

    b.vm.Set("jsonStringify", func(data goja.Value) string {
        jsonData, err := json.Marshal(data.Export())
        if err != nil {
            return ""
        }
        return string(jsonData)
    })

    b.vm.Set("sleep", func(ms int64) {
        time.Sleep(time.Duration(ms) * time.Millisecond)
    })

    b.vm.Set("timestamp", func() int64 {
        return time.Now().Unix()
    })
}

func (b *APIBinder) getPluginInstance() *JSBridgePlugin {
    // è¿™é‡Œéœ€è¦é€šè¿‡æŸç§æ–¹å¼è·å–JSBridgePluginå®ä¾‹
    // å¯ä»¥é€šè¿‡contextæˆ–è€…å…¶ä»–æ–¹å¼ä¼ é€’
    return nil // ç®€åŒ–å®ç°
}
```

### 3.2 ç¬¬äºŒé˜¶æ®µï¼šé’©å­ç³»ç»Ÿå¢å¼ºï¼ˆ1-2å‘¨ï¼‰

#### **3.2.1 äº‹ä»¶ç³»ç»Ÿå®ç°**

```go
// plugin/js/event_system.go
package js

import (
    "sync"
    "github.com/ctwj/urldb/utils"
)

type EventSystem struct {
    listeners map[string][]goja.Callable
    mutex     sync.RWMutex
}

func NewEventSystem() *EventSystem {
    return &EventSystem{
        listeners: make(map[string][]goja.Callable),
    }
}

func (e *EventSystem) On(event string, handler goja.Callable) {
    e.mutex.Lock()
    defer e.mutex.Unlock()

    e.listeners[event] = append(e.listeners[event], handler)
    utils.Debug("Registered handler for event: %s", event)
}

func (e *EventSystem) Emit(event string, data interface{}) {
    e.mutex.RLock()
    handlers, exists := e.listeners[event]
    e.mutex.RUnlock()

    if !exists {
        return
    }

    utils.Debug("Emitting event: %s to %d handlers", event, len(handlers))

    for _, handler := range handlers {
        go func(h goja.Callable) {
            // å¼‚æ­¥æ‰§è¡Œå¤„ç†å™¨
            _, err := h(nil, data)
            if err != nil {
                utils.Error("Event handler error for %s: %v", event, err)
            }
        }(handler)
    }
}

func (e *EventSystem) Off(event string, handler goja.Callable) {
    e.mutex.Lock()
    defer e.mutex.Unlock()

    handlers := e.listeners[event]
    for i, h := range handlers {
        if h == handler {
            e.listeners[event] = append(handlers[:i], handlers[i+1:]...)
            break
        }
    }
}
```

### 3.3 ç¬¬ä¸‰é˜¶æ®µï¼šå®‰å…¨å’Œç›‘æ§ï¼ˆ1å‘¨ï¼‰

#### **3.3.1 å®‰å…¨æ²™ç®±å®ç°**

```go
// plugin/js/sandbox.go
package js

import (
    "context"
    "time"
    "github.com/dop251/goja"
)

type Sandbox struct {
    maxMemory   int64
    maxExecTime time.Duration
    allowedAPIs map[string]bool
}

func NewSandbox() *Sandbox {
    return &Sandbox{
        maxMemory:   50 * 1024 * 1024, // 50MB
        maxExecTime: 30 * time.Second,
        allowedAPIs: map[string]bool{
            "log": true, "getConfig": true, "setConfig": true,
            "getData": true, "setData": true,
            "httpGet": true, "httpPost": true,
        },
    }
}

func (s *Sandbox) ExecuteWithLimit(vm *goja.Runtime, script string) (goja.Value, error) {
    ctx, cancel := context.WithTimeout(context.Background(), s.maxExecTime)
    defer cancel()

    resultChan := make(chan goja.Value, 1)
    errorChan := make(chan error, 1)

    go func() {
        value, err := vm.RunString(script)
        if err != nil {
            errorChan <- err
            return
        }
        resultChan <- value
    }()

    select {
    case result := <-resultChan:
        return result, nil
    case err := <-errorChan:
        return nil, err
    case <-ctx.Done():
        return nil, ctx.Err()
    }
}
```

## 4. ä½¿ç”¨æŒ‡å—

### 4.1 JavaScriptæ’ä»¶å¼€å‘

#### **4.1.1 åŸºç¡€æ’ä»¶æ¨¡æ¿**

```javascript
// templates/basic-plugin.js
/**
 * åŸºç¡€JavaScriptæ’ä»¶æ¨¡æ¿
 */
const plugin = {
    name: "my-plugin",
    version: "1.0.0",
    description: "æˆ‘çš„ç¬¬ä¸€ä¸ªJavaScriptæ’ä»¶",
    author: "Your Name",

    onInit: function() {
        log("info", "Plugin " + this.name + " is initializing");

        // è¯»å–é…ç½®
        const config = getConfig("welcome_message") || "Hello World";
        log("info", "Config loaded: " + config);

        // åˆå§‹åŒ–æ•°æ®
        setData("initialized_at", timestamp(), "number");
    },

    onStart: function() {
        log("info", "Plugin is starting");

        // è®¾ç½®è¿è¡ŒçŠ¶æ€
        setData("status", "running", "string");

        // æ³¨å†Œå®šæ—¶ä»»åŠ¡
        registerTask("heartbeat", function() {
            log("debug", "Heartbeat from " + plugin.name);
            setData("last_heartbeat", timestamp(), "number");
        });
    },

    onStop: function() {
        log("info", "Plugin is stopping");

        // æ›´æ–°çŠ¶æ€
        setData("status", "stopped", "string");

        // å–æ¶ˆä»»åŠ¡
        unregisterTask("heartbeat");
    },

    onCleanup: function() {
        log("info", "Plugin is cleaning up");

        // æ¸…ç†æ•°æ®
        deleteData("initialized_at", "number");
        deleteData("status", "string");
        deleteData("last_heartbeat", "number");
    }
};

// æ³¨å†Œæ’ä»¶
registerPlugin(plugin);
```

#### **4.1.2 HTTPæœåŠ¡æ’ä»¶ç¤ºä¾‹**

```javascript
// examples/http-service-plugin.js
const plugin = {
    name: "http-service",
    version: "1.0.0",
    description: "HTTPæœåŠ¡æ’ä»¶ï¼Œæä¾›å¤–éƒ¨APIè°ƒç”¨åŠŸèƒ½",

    onInit: function() {
        log("info", "Initializing HTTP service plugin");

        // è¯»å–APIé…ç½®
        this.apiBase = getConfig("api_base_url") || "https://api.example.com";
        this.apiKey = getConfig("api_key") || "";

        if (!this.apiKey) {
            log("warn", "API key not configured, some features may not work");
        }
    },

    onStart: function() {
        log("info", "Starting HTTP service plugin");

        // æ³¨å†Œå¥åº·æ£€æŸ¥ä»»åŠ¡
        registerTask("health_check", function() {
            plugin.checkAPIHealth();
        });
    },

    checkAPIHealth: function() {
        log("debug", "Checking API health...");

        const response = httpGet(this.apiBase + "/health", {
            "Authorization": "Bearer " + this.apiKey
        });

        if (response.status === 200) {
            setData("api_status", "healthy", "string");
            log("info", "API is healthy");
        } else {
            setData("api_status", "unhealthy", "string");
            log("warn", "API health check failed: " + response.status);
        }
    },

    callAPI: function(endpoint, method, data) {
        const url = this.apiBase + endpoint;
        const headers = {
            "Authorization": "Bearer " + this.apiKey,
            "Content-Type": "application/json"
        };

        let response;
        if (method === "GET") {
            response = httpGet(url, headers);
        } else if (method === "POST") {
            response = httpPost(url, data, headers);
        }

        // è®°å½•APIè°ƒç”¨
        setData("last_api_call", timestamp(), "number");
        setData("last_api_response", response.status, "number");

        return response;
    },

    onStop: function() {
        log("info", "Stopping HTTP service plugin");
        unregisterTask("health_check");
    },

    onCleanup: function() {
        log("info", "Cleaning up HTTP service plugin");
        deleteData("api_status", "string");
        deleteData("last_api_call", "number");
        deleteData("last_api_response", "number");
    }
};

// æ³¨å†Œæ’ä»¶
registerPlugin(plugin);

// å¯¼å‡ºå·¥å…·å‡½æ•°ä¾›å…¶ä»–æ’ä»¶ä½¿ç”¨
if (typeof module !== 'undefined' && module.exports) {
    module.exports = {
        callAPI: plugin.callAPI.bind(plugin)
    };
}
```

#### **4.1.3 æ•°æ®å¤„ç†æ’ä»¶ç¤ºä¾‹**

```javascript
// examples/data-processor-plugin.js
const plugin = {
    name: "data-processor",
    version: "1.0.0",
    description: "æ•°æ®å¤„ç†æ’ä»¶ï¼Œæä¾›æ•°æ®åˆ†æå’Œè½¬æ¢åŠŸèƒ½",

    onInit: function() {
        log("info", "Initializing data processor plugin");

        // è¯»å–å¤„ç†é…ç½®
        this.processInterval = getConfig("process_interval") || 300000; // 5åˆ†é’Ÿ
        this.batchSize = getConfig("batch_size") || 100;

        log("info", "Process interval: " + this.processInterval + "ms");
        log("info", "Batch size: " + this.batchSize);
    },

    onStart: function() {
        log("info", "Starting data processor plugin");

        // æ³¨å†Œæ•°æ®å¤„ç†ä»»åŠ¡
        registerTask("process_data", function() {
            plugin.processPendingData();
        });

        // ç«‹å³æ‰§è¡Œä¸€æ¬¡å¤„ç†
        this.processPendingData();
    },

    processPendingData: function() {
        log("debug", "Processing pending data...");

        try {
            // è·å–å¾…å¤„ç†æ•°æ®
            const rawData = getData("pending_data", "json") || [];

            if (rawData.length === 0) {
                log("debug", "No pending data to process");
                return;
            }

            // åˆ†æ‰¹å¤„ç†æ•°æ®
            const batches = this.createBatches(rawData, this.batchSize);

            for (let i = 0; i < batches.length; i++) {
                const batch = batches[i];
                const processed = this.processBatch(batch);

                // ä¿å­˜å¤„ç†ç»“æœ
                setData("processed_batch_" + i, processed, "json");

                log("info", "Processed batch " + (i + 1) + "/" + batches.length);
            }

            // æ¸…ç©ºå¾…å¤„ç†æ•°æ®
            setData("pending_data", [], "json");

            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            const totalProcessed = getData("total_processed", "number") || 0;
            setData("total_processed", totalProcessed + rawData.length, "number");

            log("info", "Data processing completed. Processed " + rawData.length + " items");

        } catch (error) {
            log("error", "Data processing failed: " + error.message);
            setData("processing_error", error.message, "string");
        }
    },

    createBatches: function(data, batchSize) {
        const batches = [];
        for (let i = 0; i < data.length; i += batchSize) {
            batches.push(data.slice(i, i + batchSize));
        }
        return batches;
    },

    processBatch: function(batch) {
        return batch.map(item => {
            // ç¤ºä¾‹å¤„ç†ï¼šæ·»åŠ æ—¶é—´æˆ³å’ŒçŠ¶æ€
            return {
                ...item,
                processed_at: timestamp(),
                status: "processed",
                checksum: this.calculateChecksum(item)
            };
        });
    },

    calculateChecksum: function(data) {
        // ç®€å•çš„æ ¡éªŒå’Œè®¡ç®—
        const str = jsonStringify(data);
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
            const char = str.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash; // è½¬æ¢ä¸º32ä½æ•´æ•°
        }
        return hash.toString(16);
    },

    onStop: function() {
        log("info", "Stopping data processor plugin");
        unregisterTask("process_data");
    },

    onCleanup: function() {
        log("info", "Cleaning up data processor plugin");
        // ä¿ç•™ç»Ÿè®¡æ•°æ®ï¼Œåªæ¸…ç†ä¸´æ—¶æ•°æ®
        deleteData("processing_error", "string");
    }
};

// æ³¨å†Œæ’ä»¶
registerPlugin(plugin);
```

### 4.2 éƒ¨ç½²å’Œé…ç½®

#### **4.2.1 ç›®å½•ç»“æ„**

```
urldb/
â”œâ”€â”€ plugins/
â”‚   â”œâ”€â”€ js/                    # JavaScriptæ’ä»¶ç›®å½•
â”‚   â”‚   â”œâ”€â”€ notification.js    # é€šçŸ¥æ’ä»¶
â”‚   â”‚   â”œâ”€â”€ webhook.js         # Webhookæ’ä»¶
â”‚   â”‚   â””â”€â”€ analytics.js       # åˆ†ææ’ä»¶
â”‚   â”œâ”€â”€ go/                    # Goæ’ä»¶ç›®å½•
â”‚   â”‚   â”œâ”€â”€ builtin.so         # å†…ç½®æ’ä»¶
â”‚   â”‚   â””â”€â”€ custom.so          # è‡ªå®šä¹‰Goæ’ä»¶
â”‚   â””â”€â”€ config/                # æ’ä»¶é…ç½®ç›®å½•
â”‚       â”œâ”€â”€ notification.json
â”‚       â”œâ”€â”€ webhook.json
â”‚       â””â”€â”€ analytics.json
â”œâ”€â”€ plugin/                    # æ’ä»¶ç³»ç»Ÿä»£ç 
â”‚   â”œâ”€â”€ js/                    # JSæ’ä»¶æ”¯æŒ
â”‚   â”‚   â”œâ”€â”€ js_bridge_plugin.go
â”‚   â”‚   â”œâ”€â”€ api_binder.go
â”‚   â”‚   â”œâ”€â”€ event_system.go
â”‚   â”‚   â””â”€â”€ sandbox.go
â”‚   â””â”€â”€ manager/               # æ’ä»¶ç®¡ç†å™¨
â””â”€â”€ main.go                    # ä¸»ç¨‹åº
```

#### **4.2.2 é…ç½®æ–‡ä»¶ç¤ºä¾‹**

```json
// plugins/config/notification.json
{
    "enabled": true,
    "script_path": "plugins/js/notification.js",
    "config": {
        "webhook_url": "https://hooks.slack.com/services/xxx",
        "notification_levels": ["error", "warn"],
        "batch_size": 10,
        "retry_attempts": 3
    }
}
```

#### **4.2.3 å¯åŠ¨é…ç½®**

```go
// åœ¨main.goä¸­å¯ç”¨JSæ’ä»¶æ”¯æŒ
func init() {
    // åˆå§‹åŒ–æ’ä»¶ç³»ç»Ÿ
    plugin.InitPluginSystem(taskManager, repoManager)

    // æ³¨å†ŒJSæ’ä»¶åŠ è½½å™¨
    jsLoader := js.NewJSPluginLoader("./plugins/js")
    plugin.GetManager().RegisterLoader(jsLoader)

    // åŠ è½½æ‰€æœ‰æ’ä»¶
    if err := plugin.GetManager().LoadAllPlugins(); err != nil {
        utils.Error("Failed to load plugins: %v", err)
    }
}
```

### 4.3 è°ƒè¯•å’Œæµ‹è¯•

#### **4.3.1 è°ƒè¯•å·¥å…·**

```javascript
// è°ƒè¯•è¾…åŠ©å‡½æ•°
function debug(message) {
    log("debug", "[DEBUG] " + message);
}

function inspect(obj) {
    log("info", "Inspect: " + jsonStringify(obj, null, 2));
}

function measureTime(name, fn) {
    const start = timestamp();
    const result = fn();
    const end = timestamp();
    log("info", name + " took " + (end - start) + "ms");
    return result;
}

// é”™è¯¯å¤„ç†åŒ…è£…å™¨
function safe(fn, errorHandler) {
    try {
        return fn();
    } catch (error) {
        log("error", "Error in " + fn.name + ": " + error.message);
        if (errorHandler) {
            return errorHandler(error);
        }
        return null;
    }
}
```

#### **4.3.2 å•å…ƒæµ‹è¯•**

```javascript
// ç®€å•çš„æµ‹è¯•æ¡†æ¶
function test(name, testFn) {
    try {
        testFn();
        log("info", "âœ“ " + name + " passed");
    } catch (error) {
        log("error", "âœ— " + name + " failed: " + error.message);
    }
}

function assert(condition, message) {
    if (!condition) {
        throw new Error(message || "Assertion failed");
    }
}

function assertEquals(actual, expected, message) {
    if (actual !== expected) {
        throw new Error(message || "Expected " + expected + ", got " + actual);
    }
}

// æµ‹è¯•ç¤ºä¾‹
test("Config API", function() {
    setConfig("test_key", "test_value");
    const value = getConfig("test_key");
    assertEquals(value, "test_value", "Config should be set and retrieved correctly");
});

test("Data API", function() {
    setData("test_data", "test_value", "string");
    const value = getData("test_data", "string");
    assertEquals(value, "test_value", "Data should be set and retrieved correctly");
});
```

## 5. é£é™©è¯„ä¼°ä¸æ§åˆ¶

### 5.1 æŠ€æœ¯é£é™©

#### **5.1.1 æ€§èƒ½é£é™©**

**é£é™©æè¿°ï¼š**
- JavaScriptæ‰§è¡Œæ€§èƒ½ä½äºGoåŸç”Ÿä»£ç 
- é¢‘ç¹çš„æ•°æ®ç±»å‹è½¬æ¢å¯èƒ½å½±å“æ€§èƒ½
- å†…å­˜å ç”¨å¯èƒ½å¢åŠ 

**æ§åˆ¶æªæ–½ï¼š**
- å®ç°VMæ± å‡å°‘åˆå§‹åŒ–å¼€é”€
- è®¾ç½®æ‰§è¡Œè¶…æ—¶å’Œå†…å­˜é™åˆ¶
- æä¾›æ€§èƒ½ç›‘æ§å’Œå‘Šè­¦
- å…³é”®è·¯å¾„ä»ä½¿ç”¨Goå®ç°

#### **5.1.2 ç¨³å®šæ€§é£é™©**

**é£é™©æè¿°ï¼š**
- JavaScriptè¿è¡Œæ—¶é”™è¯¯å¯èƒ½å½±å“ä¸»ç¨‹åº
- ç¬¬ä¸‰æ–¹åº“å…¼å®¹æ€§é—®é¢˜
- å†…å­˜æ³„æ¼é£é™©

**æ§åˆ¶æªæ–½ï¼š**
- å®ç°æ²™ç®±éš”ç¦»æœºåˆ¶
- å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ¢å¤
- å®šæœŸé‡å¯VMå®ä¾‹
- å……åˆ†çš„æµ‹è¯•è¦†ç›–

#### **5.1.3 å®‰å…¨é£é™©**

**é£é™©æè¿°ï¼š**
- JavaScriptä»£ç å¯èƒ½è®¿é—®ä¸åº”è®¿é—®çš„èµ„æº
- ä»£ç æ³¨å…¥æ”»å‡»é£é™©
- æ•æ„Ÿä¿¡æ¯æ³„éœ²

**æ§åˆ¶æªæ–½ï¼š**
- å®ç°APIç™½åå•æœºåˆ¶
- æƒé™æ§åˆ¶å’Œå®¡è®¡
- è¾“å…¥éªŒè¯å’Œè¿‡æ»¤
- å®‰å…¨ä»£ç å®¡æŸ¥

### 5.2 è¿ç»´é£é™©

#### **5.2.1 éƒ¨ç½²å¤æ‚æ€§**

**é£é™©æè¿°ï¼š**
- éœ€è¦ç®¡ç†JavaScriptä¾èµ–
- æ–‡ä»¶ç›‘æ§å¯èƒ½å¢åŠ ç³»ç»Ÿè´Ÿæ‹…
- é…ç½®ç®¡ç†å¤æ‚åº¦å¢åŠ 

**æ§åˆ¶æªæ–½ï¼š**
- æä¾›è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬
- ä¼˜åŒ–æ–‡ä»¶ç›‘æ§æœºåˆ¶
- ç®€åŒ–é…ç½®ç»“æ„
- æä¾›ç®¡ç†ç•Œé¢

#### **5.2.2 æ•…éšœæ’æŸ¥å›°éš¾**

**é£é™©æè¿°ï¼š**
- JavaScripté”™è¯¯éš¾ä»¥è°ƒè¯•
- å †æ ˆä¿¡æ¯å¯èƒ½ä¸å®Œæ•´
- é—®é¢˜å®šä½å¤æ‚

**æ§åˆ¶æªæ–½ï¼š**
- å®Œå–„çš„æ—¥å¿—è®°å½•
- æä¾›è°ƒè¯•å·¥å…·
- é›†æˆç›‘æ§ç³»ç»Ÿ
- å»ºç«‹æ•…éšœæ’æŸ¥æ–‡æ¡£

### 5.3 ä¸šåŠ¡é£é™©

#### **5.3.1 å¼€å‘è´¨é‡é£é™©**

**é£é™©æè¿°ï¼š**
- JavaScriptå¼€å‘é—¨æ§›ä½å¯èƒ½å¯¼è‡´ä»£ç è´¨é‡å‚å·®ä¸é½
- ç¼ºä¹ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥
- éš¾ä»¥è¿›è¡Œä»£ç å®¡æŸ¥

**æ§åˆ¶æªæ–½ï¼š**
- å»ºç«‹JavaScriptå¼€å‘è§„èŒƒ
- æä¾›ä»£ç æ¨¡æ¿å’Œæœ€ä½³å®è·µ
- å®æ–½ä»£ç å®¡æŸ¥æµç¨‹
- æä¾›é™æ€åˆ†æå·¥å…·

#### **5.3.2 ç»´æŠ¤æˆæœ¬é£é™©**

**é£é™©æè¿°ï¼š**
- æ’ä»¶æ•°é‡å¢åŠ åç»´æŠ¤æˆæœ¬ä¸Šå‡
- ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜
- æŠ€æœ¯å€ºåŠ¡ç§¯ç´¯

**æ§åˆ¶æªæ–½ï¼š**
- å»ºç«‹æ’ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†
- åˆ¶å®šç‰ˆæœ¬å…¼å®¹æ€§ç­–ç•¥
- å®šæœŸé‡æ„å’Œä¼˜åŒ–
- æä¾›è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·

## 6. æ•ˆç›Šåˆ†æ

### 6.1 å¼€å‘æ•ˆç‡æå‡

#### **6.1.1 é‡åŒ–æŒ‡æ ‡**

| æŒ‡æ ‡ | Goæ’ä»¶ | JavaScriptæ’ä»¶ | æå‡å¹…åº¦ |
|------|--------|---------------|----------|
| **å¼€å‘å‘¨æœŸ** | 3-5å¤© | 1-2å¤© | 60-70% |
| **è°ƒè¯•æ—¶é—´** | 30-60åˆ†é’Ÿ | 5-15åˆ†é’Ÿ | 75-80% |
| **å­¦ä¹ æˆæœ¬** | é«˜ï¼ˆGoè¯­è¨€ï¼‰ | ä½ï¼ˆJavaScriptï¼‰ | 60-80% |
| **ä»£ç è¡Œæ•°** | 200-300è¡Œ | 50-100è¡Œ | 50-70% |

#### **6.1.2 å®šæ€§æ”¶ç›Š**

- **å¿«é€ŸåŸå‹**ï¼šå¯ä»¥å¿«é€ŸéªŒè¯æƒ³æ³•å’Œæ¦‚å¿µ
- **çµæ´»è°ƒæ•´**ï¼šä¸šåŠ¡é€»è¾‘å˜æ›´æ—¶å“åº”æ›´å¿«
- **å›¢é˜Ÿåä½œ**ï¼šå‰ç«¯å¼€å‘è€…å¯ä»¥å‚ä¸æ’ä»¶å¼€å‘
- **ç”Ÿæ€åˆ©ç”¨**ï¼šå¯ä»¥ä½¿ç”¨ä¸°å¯Œçš„JavaScriptåº“

### 6.2 ç³»ç»Ÿå¯æ‰©å±•æ€§

#### **6.2.1 æ’ä»¶ç”Ÿæ€å»ºè®¾**

```javascript
// é¢„æœŸçš„æ’ä»¶ç±»å‹ç¤ºä¾‹
â”œâ”€â”€ é€šçŸ¥ç±»æ’ä»¶
â”‚   â”œâ”€â”€ slack-notification.js
â”‚   â”œâ”€â”€ email-notification.js
â”‚   â””â”€â”€ webhook-notification.js
â”œâ”€â”€ æ•°æ®å¤„ç†æ’ä»¶
â”‚   â”œâ”€â”€ data-validator.js
â”‚   â”œâ”€â”€ data-transformer.js
â”‚   â””â”€â”€ data-exporter.js
â”œâ”€â”€ é›†æˆæ’ä»¶
â”‚   â”œâ”€â”€ github-integration.js
â”‚   â”œâ”€â”€ jira-integration.js
â”‚   â””â”€â”€ docker-integration.js
â””â”€â”€ ç›‘æ§æ’ä»¶
    â”œâ”€â”€ metrics-collector.js
    â”œâ”€â”€ alert-manager.js
    â””â”€â”€ health-checker.js
```

#### **6.2.2 ç¤¾åŒºè´¡çŒ®**

- æ’ä»¶å¼€å‘é—¨æ§›é™ä½ï¼Œæœ‰åŠ©äºç¤¾åŒºè´¡çŒ®
- å¯ä»¥å»ºç«‹æ’ä»¶å¸‚åœºå’Œåˆ†äº«æœºåˆ¶
- ä¿ƒè¿›æœ€ä½³å®è·µçš„ä¼ æ’­

### 6.3 è¿ç»´æ•ˆç‡

#### **6.3.1 é…ç½®ç®¡ç†**

- **çƒ­é‡è½½**ï¼šæ— éœ€é‡å¯å³å¯æ›´æ–°æ’ä»¶
- **ç‰ˆæœ¬ç®¡ç†**ï¼šå¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œç‰ˆæœ¬å›æ»š
- **A/Bæµ‹è¯•**ï¼šå¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªç‰ˆæœ¬è¿›è¡Œå¯¹æ¯”

#### **6.3.2 ç›‘æ§å‘Šè­¦**

- **å®æ—¶ç›‘æ§**ï¼šå¯ä»¥å¿«é€Ÿæ·»åŠ æ–°çš„ç›‘æ§æŒ‡æ ‡
- **è‡ªå®šä¹‰å‘Šè­¦**ï¼šå¯ä»¥çµæ´»å®šä¹‰å‘Šè­¦è§„åˆ™
- **æ•…éšœè‡ªæ„ˆ**ï¼šå¯ä»¥å®ç°è‡ªåŠ¨æ•…éšœæ¢å¤æœºåˆ¶

## 7. å®æ–½è®¡åˆ’

### 7.1 æ—¶é—´çº¿è§„åˆ’

```
Phase 1: åŸºç¡€æ¡†æ¶ (Week 1-2)
â”œâ”€â”€ Week 1: æ ¸å¿ƒæ¶æ„è®¾è®¡å’Œå®ç°
â”‚   â”œâ”€â”€ JSBridgePluginåŸºç¡€å®ç°
â”‚   â”œâ”€â”€ API Binderå¼€å‘
â”‚   â””â”€â”€ åŸºç¡€æµ‹è¯•
â”œâ”€â”€ Week 2: åŠŸèƒ½å®Œå–„å’Œé›†æˆ
â”‚   â”œâ”€â”€ é’©å­ç³»ç»Ÿå®ç°
â”‚   â”œâ”€â”€ é”™è¯¯å¤„ç†å®Œå–„
â”‚   â””â”€â”€ ç³»ç»Ÿé›†æˆæµ‹è¯•

Phase 2: å¢å¼ºåŠŸèƒ½ (Week 3-4)
â”œâ”€â”€ Week 3: å®‰å…¨å’Œç›‘æ§
â”‚   â”œâ”€â”€ æ²™ç®±æœºåˆ¶å®ç°
â”‚   â”œâ”€â”€ æ€§èƒ½ç›‘æ§é›†æˆ
â”‚   â””â”€â”€ å®‰å…¨æ§åˆ¶å®Œå–„
â”œâ”€â”€ Week 4: å¼€å‘å·¥å…·
â”‚   â”œâ”€â”€ è°ƒè¯•å·¥å…·å¼€å‘
â”‚   â”œâ”€â”€ æ–‡æ¡£ç¼–å†™
â”‚   â””â”€â”€ ç¤ºä¾‹æ’ä»¶å¼€å‘

Phase 3: è¯•ç‚¹åº”ç”¨ (Week 5-6)
â”œâ”€â”€ Week 5: è¯•ç‚¹æ’ä»¶å¼€å‘
â”‚   â”œâ”€â”€ é€šçŸ¥æ’ä»¶è¿ç§»
â”‚   â”œâ”€â”€ Webhookæ’ä»¶å¼€å‘
â”‚   â””â”€â”€ æ€§èƒ½æµ‹è¯•
â””â”€â”€ Week 6: ä¼˜åŒ–å’Œæ¨å¹¿
    â”œâ”€â”€ æ€§èƒ½ä¼˜åŒ–
    â”œâ”€â”€ ç”¨æˆ·åŸ¹è®­
    â””â”€â”€ æ­£å¼å‘å¸ƒå‡†å¤‡
```

### 7.2 é‡Œç¨‹ç¢‘å®šä¹‰

#### **Milestone 1: MVPç‰ˆæœ¬ (Week 2)**
- âœ… åŸºç¡€JavaScriptæ’ä»¶æ”¯æŒ
- âœ… æ ¸å¿ƒAPIç»‘å®š
- âœ… ç®€å•çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†
- âœ… åŸºç¡€é”™è¯¯å¤„ç†

#### **Milestone 2: Betaç‰ˆæœ¬ (Week 4)**
- âœ… å®‰å…¨æ²™ç®±æœºåˆ¶
- âœ… å®Œæ•´çš„é’©å­ç³»ç»Ÿ
- âœ… ç›‘æ§å’Œæ—¥å¿—é›†æˆ
- âœ… è°ƒè¯•å·¥å…·æ”¯æŒ

#### **Milestone 3: æ­£å¼ç‰ˆæœ¬ (Week 6)**
- âœ… æ€§èƒ½ä¼˜åŒ–å®Œæˆ
- âœ… æ–‡æ¡£å’Œç¤ºä¾‹å®Œå–„
- âœ… ç”¨æˆ·åŸ¹è®­å®Œæˆ
- âœ… ç”Ÿäº§ç¯å¢ƒéªŒè¯

### 7.3 èµ„æºåˆ†é…

#### **äººå‘˜å®‰æ’**
- **æ¶æ„å¸ˆ**: 1äººï¼Œè´Ÿè´£æ•´ä½“æ¶æ„è®¾è®¡å’ŒæŠ€æœ¯å†³ç­–
- **Goå¼€å‘å·¥ç¨‹å¸ˆ**: 2äººï¼Œè´Ÿè´£æ ¸å¿ƒåŠŸèƒ½å¼€å‘
- **å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ**: 1äººï¼Œè´Ÿè´£APIè®¾è®¡å’Œç¤ºä¾‹å¼€å‘
- **æµ‹è¯•å·¥ç¨‹å¸ˆ**: 1äººï¼Œè´Ÿè´£æµ‹è¯•ç”¨ä¾‹è®¾è®¡æ‰§è¡Œ
- **æŠ€æœ¯æ–‡æ¡£å·¥ç¨‹å¸ˆ**: 1äººï¼Œè´Ÿè´£æ–‡æ¡£ç¼–å†™å’Œç»´æŠ¤

#### **ç¡¬ä»¶èµ„æº**
- **å¼€å‘ç¯å¢ƒ**: æ ‡å‡†å¼€å‘æœºå™¨ï¼Œæ”¯æŒGoå’ŒJavaScriptå¼€å‘
- **æµ‹è¯•ç¯å¢ƒ**: æ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒçš„æµ‹è¯•é›†ç¾¤
- **ç›‘æ§å·¥å…·**: Prometheus + Grafanaç›‘æ§æ ˆ

## 8. æ€»ç»“

### 8.1 æ–¹æ¡ˆæ¦‚è¿°

æœ¬æ–¹æ¡ˆæå‡ºäº†ä¸€ç§åœ¨urlDBç³»ç»Ÿä¸­å¼•å…¥JavaScriptæ’ä»¶æ”¯æŒçš„ç®€åŒ–å®ç°æ–¹æ¡ˆã€‚é€šè¿‡æ¡¥æ¥æ¨¡å¼è®¾è®¡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¿æŒç°æœ‰Goæ’ä»¶ç³»ç»Ÿç¨³å®šæ€§çš„åŒæ—¶ï¼Œä¸ºå¼€å‘è€…æä¾›æ›´é«˜æ•ˆçš„JavaScriptæ’ä»¶å¼€å‘ä½“éªŒã€‚

### 8.2 æ ¸å¿ƒä¼˜åŠ¿

1. **å¹³è¡¡æ€§æœ€ä½³**ï¼šåœ¨å¼€å‘æ•ˆç‡å’Œç³»ç»Ÿæ€§èƒ½é—´æ‰¾åˆ°æœ€ä½³å¹³è¡¡
2. **é£é™©å¯æ§**ï¼šåŸºäºæˆç†Ÿæ¶æ„ï¼Œæ¸è¿›å¼å®ç°ï¼Œå¤±è´¥æˆæœ¬ä½
3. **å…¼å®¹æ€§å¥½**ï¼šä¸ç°æœ‰ç³»ç»Ÿå®Œå…¨å…¼å®¹ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½
4. **æ‰©å±•æ€§å¼º**ï¼šä¸ºæœªæ¥åŠŸèƒ½æ‰©å±•å’Œç”Ÿæ€å»ºè®¾å¥ å®šåŸºç¡€

### 8.3 é¢„æœŸæ•ˆæœ

å®æ–½æœ¬æ–¹æ¡ˆåï¼Œé¢„æœŸå¯ä»¥è·å¾—ä»¥ä¸‹æ•ˆæœï¼š

- **å¼€å‘æ•ˆç‡æå‡60-70%**ï¼šJavaScriptå¼€å‘æ›´å¿«é€Ÿä¾¿æ·
- **å­¦ä¹ æˆæœ¬é™ä½60-80%**ï¼šå‰ç«¯å¼€å‘è€…å¯ä»¥å¿«é€Ÿä¸Šæ‰‹
- **æ’ä»¶ç”Ÿæ€ç¹è£**ï¼šé™ä½é—¨æ§›ä¿ƒè¿›ç¤¾åŒºè´¡çŒ®
- **è¿ç»´æ•ˆç‡æå‡**ï¼šçƒ­é‡è½½å’Œçµæ´»é…ç½®å‡å°‘ç»´æŠ¤å·¥ä½œ

### 8.4 é£é™©æ§åˆ¶

é€šè¿‡ä»¥ä¸‹æªæ–½ç¡®ä¿æ–¹æ¡ˆæˆåŠŸå®æ–½ï¼š

1. **æŠ€æœ¯é£é™©æ§åˆ¶**ï¼šæ²™ç®±éš”ç¦»ã€é”™è¯¯å¤„ç†ã€æ€§èƒ½ç›‘æ§
2. **è´¨é‡é£é™©æ§åˆ¶**ï¼šå¼€å‘è§„èŒƒã€ä»£ç å®¡æŸ¥ã€è‡ªåŠ¨åŒ–æµ‹è¯•
3. **è¿ç»´é£é™©æ§åˆ¶**ï¼šå®Œå–„æ–‡æ¡£ã€ç›‘æ§å‘Šè­¦ã€æ•…éšœé¢„æ¡ˆ

### 8.5 åç»­è§„åˆ’

åœ¨å®ŒæˆåŸºç¡€ç‰ˆæœ¬åï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹æ‰©å±•æ–¹å‘ï¼š

1. **TypeScriptæ”¯æŒ**ï¼šæä¾›ç±»å‹å®‰å…¨å’Œæ›´å¥½çš„å¼€å‘ä½“éªŒ
2. **æ’ä»¶å¸‚åœº**ï¼šå»ºç«‹æ’ä»¶åˆ†äº«å’Œåˆ†å‘æœºåˆ¶
3. **å¯è§†åŒ–å¼€å‘**ï¼šæä¾›å›¾å½¢åŒ–çš„æ’ä»¶å¼€å‘å·¥å…·
4. **äº‘åŸç”Ÿæ”¯æŒ**ï¼šæ”¯æŒå®¹å™¨åŒ–å’Œå¾®æœåŠ¡æ¶æ„

æœ¬æ–¹æ¡ˆä¸ºurlDBç³»ç»Ÿçš„æ’ä»¶åŒ–å‘å±•æä¾›äº†ä¸€ä¸ªåŠ¡å®ä¸”å‰ç»çš„è§£å†³æ–¹æ¡ˆï¼Œæ—¢è§£å†³äº†å½“å‰çš„å¼€å‘æ•ˆç‡é—®é¢˜ï¼Œåˆä¸ºæœªæ¥çš„æ‰©å±•ç•™ä¸‹äº†å……è¶³ç©ºé—´ã€‚é€šè¿‡åˆç†çš„è§„åˆ’å’Œæ‰§è¡Œï¼Œå¯ä»¥æ˜¾è‘—æå‡ç³»ç»Ÿçš„å¼€å‘æ•ˆç‡å’Œå¯ç»´æŠ¤æ€§ã€‚