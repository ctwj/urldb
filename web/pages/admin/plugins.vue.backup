<template>
  <AdminPageLayout>
    <!-- é¡µé¢å¤´éƒ¨ - æ ‡é¢˜å’Œæ“ä½œæŒ‰é’® -->
    <template #page-header>
      <div>
        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">
          <i class="fas fa-plug mr-3 text-blue-500"></i>
          æ’ä»¶ç®¡ç†
        </h1>
        <p class="text-gray-600 dark:text-gray-400">ç®¡ç†ç³»ç»Ÿæ’ä»¶ï¼Œé…ç½®æ’ä»¶å‚æ•°ï¼Œç›‘æ§æ’ä»¶è¿è¡ŒçŠ¶æ€</p>
      </div>
      <div class="flex space-x-3">
        <n-button @click="openPluginMarket" type="primary">
          <template #icon>
            <i class="fas fa-plus"></i>
          </template>
          æ’ä»¶å¸‚åœº
        </n-button>
        <n-button @click="refreshPlugins" :loading="loading">
          <template #icon>
            <i class="fas fa-refresh"></i>
          </template>
          åˆ·æ–°
        </n-button>
      </div>
    </template>

    <!-- é€šçŸ¥åŒºåŸŸ -->
    <template #notice-section>
      <n-alert title="æ’ä»¶ç®¡ç†åŠŸèƒ½ï¼Œå¯ä»¥å¯ç”¨ã€ç¦ç”¨ã€é…ç½®æ’ä»¶ï¼Œä»¥åŠæŸ¥çœ‹æ’ä»¶è¿è¡Œæ—¥å¿—" type="info" />
    </template>

    <!-- è¿‡æ»¤æ  -->
    <template #filter-bar>
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4">
        <div class="flex flex-col md:flex-row gap-4">
          <!-- æœç´¢æ¡† -->
          <div class="flex-1">
            <n-input v-model:value="searchQuery" placeholder="æœç´¢æ’ä»¶..." clearable>
              <template #prefix>
                <i class="fas fa-search"></i>
              </template>
            </n-input>
          </div>

          <!-- çŠ¶æ€è¿‡æ»¤ -->
          <n-select v-model:value="statusFilter" placeholder="å…¨éƒ¨çŠ¶æ€" :options="statusOptions" clearable class="w-full md:w-40" />

          <!-- åˆ†ç±»è¿‡æ»¤ -->
          <n-select v-model:value="categoryFilter" placeholder="å…¨éƒ¨åˆ†ç±»" :options="categoryOptions" clearable class="w-full md:w-40" />
        </div>
      </div>
    </template>

    <!-- å†…å®¹åŒºheader -->
    <template #content-header>
      <div class="flex items-center justify-between">
        <span class="text-lg font-semibold">æ’ä»¶åˆ—è¡¨</span>
        <span class="text-sm text-gray-500">å…± {{ filteredPlugins.length }} ä¸ªæ’ä»¶</span>
      </div>
    </template>

    <!-- å†…å®¹åŒº - æ’ä»¶åˆ—è¡¨ -->
    <template #content>
      <div v-if="loading" class="flex items-center justify-center py-12">
        <n-spin size="large">
          <template #description>
            <span class="text-gray-500 dark:text-gray-400">åŠ è½½ä¸­...</span>
          </template>
        </n-spin>
      </div>

      <div v-else-if="filteredPlugins.length === 0" class="flex flex-col items-center justify-center py-12">
        <n-empty description="æš‚æ— æ’ä»¶">
          <template #icon>
            <i class="fas fa-plug text-4xl text-gray-400"></i>
          </template>
          <template #extra>
            <n-button @click="openPluginMarket" type="primary">
              <template #icon>
                <i class="fas fa-plus"></i>
              </template>
              æ·»åŠ æ’ä»¶
            </n-button>
          </template>
        </n-empty>
      </div>

      <div v-else class="flex flex-col">
        <div class="divide-y divide-gray-200 dark:divide-gray-700">
          <div
            v-for="plugin in paginatedPlugins"
            :key="plugin.id"
            class="p-4 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors"
          >
            <div class="flex items-center justify-between">
              <!-- å·¦ä¾§ä¿¡æ¯ -->
              <div class="flex-1 min-w-0">
                <div class="flex items-center space-x-4">
                  <!-- æ’ä»¶å›¾æ ‡ -->
                  <div class="flex-shrink-0">
                    <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/20 rounded-lg flex items-center justify-center">
                      <i class="fas fa-plug text-blue-600 dark:text-blue-400 text-lg"></i>
                    </div>
                  </div>

                  <!-- æ’ä»¶ä¿¡æ¯ -->
                  <div class="flex-1 min-w-0">
                    <div class="flex items-center space-x-3">
                      <h3 class="text-lg font-medium text-gray-900 dark:text-white truncate">
                        {{ plugin.display_name || plugin.name }}
                      </h3>
                      <n-tag :type="plugin.enabled ? 'success' : 'error'" size="small">
                        {{ plugin.enabled ? 'å·²æ¿€æ´»' : 'å·²ç¦ç”¨' }}
                      </n-tag>
                      <n-tag v-if="plugin.has_scheduled_task" type="info" size="small">
                        <template #icon>
                          <i class="fas fa-clock"></i>
                        </template>
                        {{ getPrimaryScheduleFrequency(plugin) }}
                      </n-tag>
                      <span class="text-sm text-gray-500 dark:text-gray-400">
                        v{{ plugin.version }}
                      </span>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1 line-clamp-1">
                      {{ plugin.description }}
                    </p>
                    <div class="flex items-center space-x-4 mt-2 text-xs text-gray-500 dark:text-gray-400">
                      <span><i class="fas fa-user mr-1"></i>{{ plugin.author }}</span>
                      <span><i class="fas fa-code-branch mr-1"></i>{{ plugin.category || 'utility' }}</span>
                      <span v-if="plugin.executions">
                        <i class="fas fa-play mr-1"></i>{{ plugin.executions }}æ¬¡æ‰§è¡Œ
                      </span>
                      <span v-if="plugin.avg_duration">
                        <i class="fas fa-clock mr-1"></i>{{ plugin.avg_duration }}ms
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- å³ä¾§æ“ä½œæŒ‰é’® -->
              <div class="flex items-center space-x-2 ml-4">
                <n-button size="small" @click="viewPluginDetails(plugin)" type="info" text>
                  <template #icon>
                    <i class="fas fa-info-circle"></i>
                  </template>
                  è¯¦æƒ…
                </n-button>
                <n-button size="small" @click="configurePlugin(plugin)" type="warning" text>
                  <template #icon>
                    <i class="fas fa-cog"></i>
                  </template>
                  é…ç½®
                </n-button>
                <n-button size="small" @click="viewPluginLogs(plugin)" type="tertiary" text>
                  <template #icon>
                    <i class="fas fa-file-alt"></i>
                  </template>
                  æ—¥å¿—
                </n-button>
                <n-button
                  size="small"
                  :type="plugin.enabled ? 'error' : 'success'"
                  @click="togglePlugin(plugin)"
                  text
                >
                  <template #icon>
                    <i :class="plugin.enabled ? 'fas fa-stop' : 'fas fa-play'"></i>
                  </template>
                  {{ plugin.enabled ? 'ç¦ç”¨' : 'å¯ç”¨' }}
                </n-button>
              </div>
            </div>
          </div>
        </div>

        <!-- åˆ†é¡µ -->
        <div v-if="totalPages > 1" class="p-4 border-t border-gray-200 dark:border-gray-700">
          <div class="flex items-center justify-between">
            <div class="text-sm text-gray-700 dark:text-gray-400">
              æ˜¾ç¤º {{ (currentPage - 1) * pageSize + 1 }} åˆ° {{ Math.min(currentPage * pageSize, filteredPlugins.length) }} ä¸ªï¼Œå…± {{ filteredPlugins.length }} ä¸ªæ’ä»¶
            </div>
            <n-pagination
              v-model:page="currentPage"
              v-model:page-size="pageSize"
              :item-count="filteredPlugins.length"
              :page-sizes="[10, 20, 50, 100]"
              show-size-picker
              @update:page="currentPage = $event"
              @update:page-size="pageSize = $event; currentPage = 1"
            />
          </div>
        </div>
      </div>
      </template>

    <!-- æ’ä»¶è¯¦æƒ…æ¨¡æ€æ¡† -->
    <n-modal v-model:show="showDetailModal" preset="card" title="æ’ä»¶è¯¦æƒ…" style="width: 600px">
      <div v-if="selectedPlugin" class="space-y-4">
        <div class="flex items-center space-x-4">
          <div class="w-16 h-16 bg-blue-100 dark:bg-blue-900/20 rounded-lg flex items-center justify-center">
            <i class="fas fa-plug text-blue-600 dark:text-blue-400 text-2xl"></i>
          </div>
          <div>
            <h3 class="text-xl font-bold text-gray-900 dark:text-white">{{ selectedPlugin.display_name || selectedPlugin.name }}</h3>
            <p class="text-gray-600 dark:text-gray-400">{{ selectedPlugin.description }}</p>
            <div class="flex items-center space-x-2 mt-1">
              <n-tag :type="selectedPlugin.enabled ? 'success' : 'error'" size="small">
                {{ selectedPlugin.enabled ? 'å·²æ¿€æ´»' : 'å·²ç¦ç”¨' }}
              </n-tag>
              <span class="text-sm text-gray-500">v{{ selectedPlugin.version }}</span>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">ä½œè€…</label>
            <p class="text-gray-900 dark:text-white">{{ selectedPlugin.author }}</p>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">åˆ†ç±»</label>
            <p class="text-gray-900 dark:text-white">{{ selectedPlugin.category || 'utility' }}</p>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">æ‰§è¡Œæ¬¡æ•°</label>
            <p class="text-gray-900 dark:text-white">{{ selectedPlugin.executions || 0 }}</p>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">å¹³å‡è€—æ—¶</label>
            <p class="text-gray-900 dark:text-white">{{ selectedPlugin.avg_duration || 0 }}ms</p>
          </div>
        </div>

        <div v-if="selectedPlugin.permissions">
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">æƒé™</label>
          <div class="flex flex-wrap gap-2">
            <n-tag v-for="permission in selectedPlugin.permissions" :key="permission" size="small">
              {{ permission }}
            </n-tag>
          </div>
        </div>

        <div v-if="selectedPlugin.scheduled_tasks && selectedPlugin.scheduled_tasks.length > 0">
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            <i class="fas fa-clock mr-1"></i>å®šæ—¶ä»»åŠ¡
          </label>
          <div class="space-y-2">
            <div v-for="task in selectedPlugin.scheduled_tasks" :key="task.name"
                 class="bg-gray-50 dark:bg-gray-800 rounded-lg p-3 border border-gray-200 dark:border-gray-700">
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                  <i class="fas fa-clock text-blue-500"></i>
                  <span class="font-medium text-gray-900 dark:text-white">{{ task.name }}</span>
                  <n-tag size="small" type="info">{{ task.schedule }}</n-tag>
                </div>
                <span class="text-xs text-gray-500 dark:text-gray-400">ç¬¬{{ task.line }}è¡Œ</span>
              </div>
            </div>
          </div>
        </div>

        <div v-if="selectedPlugin.dependencies">
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ä¾èµ–</label>
          <div class="flex flex-wrap gap-2">
            <n-tag v-for="dep in selectedPlugin.dependencies" :key="dep" size="small" type="warning">
              {{ dep }}
            </n-tag>
          </div>
        </div>
      </div>
    </n-modal>

    <!-- æ’ä»¶é…ç½®æ¨¡æ€æ¡† -->
    <n-modal v-model:show="showConfigModal" preset="card" title="æ’ä»¶é…ç½®" style="width: 800px">
      <div v-if="configPlugin" class="space-y-4">
        <div class="flex items-center justify-between mb-4">
          <div>
            <h3 class="text-lg font-medium text-gray-900 dark:text-white">{{ configPlugin.display_name || configPlugin.name }} é…ç½®</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
              {{ configPlugin.description }}
            </p>
          </div>
          <div class="flex items-center space-x-2">
            <n-button @click="resetConfig" size="small" type="warning">é‡ç½®</n-button>
          </div>
        </div>

        <!-- ä½¿ç”¨åŠ¨æ€é…ç½®è¡¨å•ç»„ä»¶ -->
        <PluginConfigForm
          :plugin="configPlugin"
          :config="pluginConfig"
          @save="saveConfig"
          @reset="resetConfig"
        />
      </div>
    </n-modal>

    <!-- æ’ä»¶æ—¥å¿—æ¨¡æ€æ¡† -->
    <n-modal v-model:show="showLogsModal" preset="card" title="æ’ä»¶æ—¥å¿—" style="width: 800px">
      <div v-if="logsPlugin" class="space-y-4">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-medium text-gray-900 dark:text-white">{{ logsPlugin.display_name || logsPlugin.name }} æ—¥å¿—</h3>
          <div class="flex items-center space-x-2">
            <n-button @click="refreshLogs" :loading="loadingLogs" size="small" type="info">
              <template #icon>
                <i class="fas fa-refresh"></i>
              </template>
              åˆ·æ–°
            </n-button>
          </div>
        </div>

        <div v-if="loadingLogs" class="flex items-center justify-center py-8">
          <n-spin size="medium" />
        </div>

        <div v-else-if="pluginLogs.length === 0" class="text-center py-8">
          <n-empty description="æš‚æ— æ—¥å¿—" />
        </div>

        <div v-else class="space-y-2 max-h-96 overflow-y-auto">
          <div
            v-for="log in pluginLogs"
            :key="log.id"
            class="p-3 bg-gray-50 dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700"
          >
            <div class="flex items-center justify-between mb-1">
              <div class="flex items-center space-x-2">
                <span class="text-sm font-medium text-gray-900 dark:text-white">
                  {{ log.hook_name }}
                </span>
                <span
                  class="px-2 py-0.5 text-xs font-medium rounded-full"
                  :class="log.success ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'"
                >
                  {{ log.success ? 'æˆåŠŸ' : 'å¤±è´¥' }}
                </span>
                <span class="text-xs text-gray-500 dark:text-gray-400">
                  {{ log.execution_time }}ms
                </span>
              </div>
              <span class="text-xs text-gray-500 dark:text-gray-400">
                {{ formatTime(log.created_at) }}
              </span>
            </div>
            <div v-if="!log.success && log.error_message" class="mt-2">
              <p class="text-sm text-red-600 dark:text-red-400 break-all">{{ log.error_message }}</p>
            </div>
            <div class="mt-1">
              <p class="text-xs text-gray-500 dark:text-gray-400">
                æ’ä»¶: {{ log.plugin_name }} | æ—¥å¿—ID: {{ log.id }}
              </p>
            </div>
          </div>
        </div>
      </div>
    </n-modal>
  </AdminPageLayout>
</template>

<script setup>
// å¯¼å…¥ç»„ä»¶
import AdminPageLayout from '~/components/AdminPageLayout.vue'
import PluginConfigForm from '~/components/plugins/PluginConfigForm.vue'

definePageMeta({
  layout: 'admin',
  ssr: false
})

const notification = useNotification()

// å“åº”å¼æ•°æ®
const loading = ref(false)
const plugins = ref([])

// è¿‡æ»¤å’Œæœç´¢
const searchQuery = ref('')
const statusFilter = ref('')
const categoryFilter = ref('')

// åˆ†é¡µ
const currentPage = ref(1)
const pageSize = ref(10)

// æ¨¡æ€æ¡†çŠ¶æ€
const showDetailModal = ref(false)
const showConfigModal = ref(false)
const showLogsModal = ref(false)
const selectedPlugin = ref(null)
const configPlugin = ref(null)
const logsPlugin = ref(null)
const pluginConfig = ref({})
const pluginLogs = ref([])
const loadingLogs = ref(false)
const saving = ref(false)

// è¿‡æ»¤é€‰é¡¹
const statusOptions = [
  { label: 'å·²å¯ç”¨', value: 'enabled' },
  { label: 'å·²ç¦ç”¨', value: 'disabled' }
]

const categoryOptions = [
  { label: 'å·¥å…·', value: 'utility' },
  { label: 'åˆ†æ', value: 'analytics' },
  { label: 'é€šçŸ¥', value: 'notification' }
]

// è®¡ç®—å±æ€§
const filteredPlugins = computed(() => {
  let filtered = plugins.value

  // æœç´¢è¿‡æ»¤
  if (searchQuery.value) {
    const query = searchQuery.value.toLowerCase()
    filtered = filtered.filter(plugin =>
      plugin.name.toLowerCase().includes(query) ||
      (plugin.display_name && plugin.display_name.toLowerCase().includes(query)) ||
      plugin.description.toLowerCase().includes(query) ||
      plugin.author.toLowerCase().includes(query)
    )
  }

  // çŠ¶æ€è¿‡æ»¤
  if (statusFilter.value) {
    filtered = filtered.filter(plugin => {
      if (statusFilter.value === 'enabled') return plugin.enabled
      if (statusFilter.value === 'disabled') return !plugin.enabled
      return true
    })
  }

  // åˆ†ç±»è¿‡æ»¤
  if (categoryFilter.value) {
    filtered = filtered.filter(plugin => plugin.category === categoryFilter.value)
  }

  return filtered
})

const totalPages = computed(() => {
  return Math.ceil(filteredPlugins.value.length / pageSize.value)
})

const paginatedPlugins = computed(() => {
  const start = (currentPage.value - 1) * pageSize.value
  const end = start + pageSize.value
  return filteredPlugins.value.slice(start, end)
})

// æ–¹æ³•
const loadPlugins = async () => {
  try {
    loading.value = true
    const response = await $fetch('/api/plugins')
    if (response.success) {
      plugins.value = response.data
    }
  } catch (error) {
    console.error('åŠ è½½æ’ä»¶åˆ—è¡¨å¤±è´¥:', error)
    notification.error({
      title: 'å¤±è´¥',
      content: 'åŠ è½½æ’ä»¶åˆ—è¡¨å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'),
      duration: 3000
    })
  } finally {
    loading.value = false
  }
}

const refreshPlugins = async () => {
  await loadPlugins()
}

const togglePlugin = async (plugin) => {
  try {
    // ç§»é™¤.pluginåç¼€ï¼Œå› ä¸ºåç«¯APIæœŸæœ›ä¸å¸¦åç¼€çš„åç§°
    const pluginName = plugin.name.replace('.plugin', '')
    const action = plugin.enabled ? 'disable' : 'enable'
    const response = await $fetch(`/api/plugins/${pluginName}/${action}`, {
      method: 'POST'
    })
    if (response.success) {
      notification.success({
        title: 'æˆåŠŸ',
        content: `æ’ä»¶å·²${plugin.enabled ? 'ç¦ç”¨' : 'å¯ç”¨'}`,
        duration: 3000
      })
      await loadPlugins()
    }
  } catch (error) {
    console.error(`${plugin.enabled ? 'ç¦ç”¨' : 'å¯ç”¨'}æ’ä»¶å¤±è´¥:`, error)
    notification.error({
      title: 'å¤±è´¥',
      content: `${plugin.enabled ? 'ç¦ç”¨' : 'å¯ç”¨'}æ’ä»¶å¤±è´¥: ` + (error.message || 'æœªçŸ¥é”™è¯¯'),
      duration: 3000
    })
  }
}

const viewPluginDetails = (plugin) => {
  selectedPlugin.value = plugin
  showDetailModal.value = true
}

const configurePlugin = async (plugin) => {
  configPlugin.value = plugin
  // åŠ è½½æ’ä»¶é…ç½®
  try {
    // ç§»é™¤.pluginåç¼€ï¼Œå› ä¸ºåç«¯APIæœŸæœ›ä¸å¸¦åç¼€çš„åç§°
    const pluginName = plugin.name.replace('.plugin', '')
    const response = await $fetch(`/api/plugins/${pluginName}`)
    console.log('ğŸ” é…ç½®APIå“åº”:', response)
    if (response.success && response.data.plugin) {
      pluginConfig.value = response.data.plugin.config || {}
      console.log('âœ… åŠ è½½çš„é…ç½®:', pluginConfig.value)
    } else {
      console.log('âŒ APIå“åº”ç»“æ„å¼‚å¸¸')
      pluginConfig.value = {}
    }
  } catch (error) {
    console.error('ğŸ’¥ åŠ è½½æ’ä»¶é…ç½®å¤±è´¥:', error)
    pluginConfig.value = {}
  }
  showConfigModal.value = true
}

const viewPluginLogs = async (plugin) => {
  logsPlugin.value = plugin
  await loadPluginLogs()
  showLogsModal.value = true
}

const loadPluginLogs = async () => {
  if (!logsPlugin.value) return

  try {
    loadingLogs.value = true
    // ç§»é™¤.pbåç¼€ï¼Œå› ä¸ºåç«¯APIæœŸæœ›ä¸å¸¦åç¼€çš„åç§°
    const pluginName = logsPlugin.value.name.replace('.plugin', '')
    const response = await $fetch(`/api/plugins/${pluginName}/logs?limit=50`)
    if (response.success) {
      pluginLogs.value = response.data.logs || []
    }
  } catch (error) {
    console.error('åŠ è½½æ’ä»¶æ—¥å¿—å¤±è´¥:', error)
    pluginLogs.value = []
  } finally {
    loadingLogs.value = false
  }
}

const refreshLogs = async () => {
  await loadPluginLogs()
}

const saveConfig = async (formData) => {
  if (!configPlugin.value) return

  try {
    saving.value = true
    // ç§»é™¤.pbåç¼€ï¼Œå› ä¸ºåç«¯APIæœŸæœ›ä¸å¸¦åç¼€çš„åç§°
    const pluginName = configPlugin.value.name.replace('.plugin', '')
    const response = await $fetch(`/api/plugins/${pluginName}/config`, {
      method: 'PUT',
      body: {
        config: formData
      }
    })
    if (response.success) {
      notification.success({
        title: 'æˆåŠŸ',
        content: 'é…ç½®å·²ä¿å­˜',
        duration: 3000
      })
      showConfigModal.value = false
      await loadPlugins()
    }
  } catch (error) {
    console.error('ä¿å­˜é…ç½®å¤±è´¥:', error)
    notification.error({
      title: 'å¤±è´¥',
      content: 'ä¿å­˜é…ç½®å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'),
      duration: 3000
    })
  } finally {
    saving.value = false
  }
}

const resetConfig = () => {
  pluginConfig.value = {}
}

const openPluginMarket = () => {
  notification.info({
    title: 'æç¤º',
    content: 'æ’ä»¶å¸‚åœºåŠŸèƒ½å¼€å‘ä¸­...',
    duration: 3000
  })
}

const getPrimaryScheduleFrequency = (plugin) => {
  if (!plugin.scheduled_tasks || plugin.scheduled_tasks.length === 0) {
    return 'å®šæ—¶ä»»åŠ¡'
  }

  // è·å–ç¬¬ä¸€ä¸ªå®šæ—¶ä»»åŠ¡çš„é¢‘ç‡
  const firstTask = plugin.scheduled_tasks[0]
  if (firstTask.frequency && firstTask.frequency.interval) {
    // ç®€åŒ–æ˜¾ç¤ºï¼Œåªæ˜¾ç¤ºé—´éš”
    return firstTask.frequency.interval
  }

  return 'å®šæ—¶ä»»åŠ¡'
}

const formatTime = (timestamp) => {
  if (!timestamp) return '-'
  return new Date(timestamp).toLocaleString()
}

// ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  refreshPlugins()
})

// ç›‘å¬è¿‡æ»¤å™¨å˜åŒ–ï¼Œé‡ç½®åˆ†é¡µ
watch([searchQuery, statusFilter, categoryFilter], () => {
  currentPage.value = 1
})
</script>

<style scoped>
.line-clamp-1 {
  overflow: hidden;
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 1;
}
</style>