<template>
  <n-modal v-model:show="visible" :mask-closable="false" preset="card" :style="{ maxWidth: '900px', width: '95%', maxHeight: '90vh' }" title="æ’ä»¶å¼€å‘è¯´æ˜">
    <div class="space-y-6 overflow-auto" style="max-height: calc(90vh - 120px);">
      <!-- æ’ä»¶æ¦‚è¿° -->
      <section>
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-3 flex items-center">
          <i class="fas fa-info-circle text-blue-500 mr-2"></i>
          æ’ä»¶æ¦‚è¿°
        </h3>
        <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4">
          <p class="text-sm text-gray-700 dark:text-gray-300">
            URLDB æ’ä»¶ç³»ç»Ÿå…è®¸å¼€å‘è€…åˆ›å»ºè‡ªå®šä¹‰åŠŸèƒ½æ¨¡å—ï¼Œé€šè¿‡ JavaScript é’©å­å‡½æ•°ç›‘å¬ç³»ç»Ÿäº‹ä»¶ï¼Œæ‰©å±•ç³»ç»Ÿèƒ½åŠ›ã€‚
            æ’ä»¶å¯ä»¥ç›‘å¬ç”¨æˆ·ç™»å½•ã€URLæ·»åŠ ã€URLè®¿é—®ç­‰äº‹ä»¶ï¼Œå¹¶æ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘ã€‚
          </p>
        </div>
      </section>

      <!-- æ”¯æŒçš„äº‹ä»¶é’©å­ -->
      <section>
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-3 flex items-center">
          <i class="fas fa-hooks text-green-500 mr-2"></i>
          æ”¯æŒçš„äº‹ä»¶é’©å­
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4">
            <h4 class="font-medium text-gray-900 dark:text-white mb-2">onURLAdd</h4>
            <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">å½“æ–°URLè¢«æ·»åŠ æ—¶è§¦å‘</p>
            <pre class="text-xs bg-gray-100 dark:bg-gray-900 p-2 rounded overflow-x-auto"><code>onURLAdd(function(event) {
    log("info", "æ–°URLæ·»åŠ : " + event.url.url, "my_plugin");
    // event.url åŒ…å«å®Œæ•´çš„URLä¿¡æ¯
});</code></pre>
          </div>

          <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4">
            <h4 class="font-medium text-gray-900 dark:text-white mb-2">onUserLogin</h4>
            <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">å½“ç”¨æˆ·ç™»å½•æ—¶è§¦å‘</p>
            <pre class="text-xs bg-gray-100 dark:bg-gray-900 p-2 rounded overflow-x-auto"><code>onUserLogin(function(event) {
    log("info", "ç”¨æˆ·ç™»å½•: " + event.user.username, "my_plugin");
    // event.user åŒ…å«ç”¨æˆ·ä¿¡æ¯
});</code></pre>
          </div>

          <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4">
            <h4 class="font-medium text-gray-900 dark:text-white mb-2">onURLAccess</h4>
            <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">å½“URLè¢«è®¿é—®æ—¶è§¦å‘</p>
            <pre class="text-xs bg-gray-100 dark:bg-gray-900 p-2 rounded overflow-x-auto"><code>onURLAccess(function(event) {
    log("info", "URLè®¿é—®: " + event.url.url, "my_plugin");
    // event.url, event.request, event.response
});</code></pre>
          </div>

          <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4">
            <h4 class="font-medium text-gray-900 dark:text-white mb-2">å®šæ—¶ä»»åŠ¡</h4>
            <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">å®šæ—¶æ‰§è¡Œçš„ä»»åŠ¡</p>
            <pre class="text-xs bg-gray-100 dark:bg-gray-900 p-2 rounded overflow-x-auto"><code>cron("task_name", "*/5 * * * *", function() {
    log("info", "å®šæ—¶ä»»åŠ¡æ‰§è¡Œ", "my_plugin");
});</code></pre>
          </div>
        </div>
      </section>

      <!-- æ’ä»¶ç»“æ„ -->
      <section>
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-3 flex items-center">
          <i class="fas fa-file-code text-purple-500 mr-2"></i>
          æ’ä»¶æ–‡ä»¶ç»“æ„
        </h3>
        <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4">
          <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">æ’ä»¶æ–‡ä»¶ä½¿ç”¨ <code class="bg-gray-200 dark:bg-gray-700 px-1 rounded">.plugin.js</code> æ‰©å±•åï¼ŒåŸºäº JavaScript å¼€å‘ã€‚</p>

          <h4 class="font-medium text-gray-900 dark:text-white mb-2">åŸºæœ¬ç»“æ„ç¤ºä¾‹ï¼š</h4>
          <pre class="text-xs bg-gray-100 dark:bg-gray-900 p-3 rounded overflow-x-auto"><code>/**
 * æ’ä»¶å…ƒä¿¡æ¯ - ä½¿ç”¨ JSDoc æ³¨é‡Šæ ¼å¼
 *
 * @name my_plugin
 * @display_name æˆ‘çš„æ’ä»¶
 * @author å¼€å‘è€…å§“å
 * @description æ’ä»¶åŠŸèƒ½æè¿°
 * @version 1.0.0
 * @category utility
 * @license MIT
 */

// è®°å½•æ’ä»¶åŠ è½½æ—¥å¿—
log("info", "æ’ä»¶å·²åŠ è½½", "my_plugin");

// ç›‘å¬ URL æ·»åŠ äº‹ä»¶
onURLAdd(function(event) {
    log("info", "=== onURLAdd äº‹ä»¶è§¦å‘ ===", "my_plugin");
    log("info", "URL: " + event.url.url, "my_plugin");
    log("info", "æ ‡é¢˜: " + event.url.title, "my_plugin");

    // è‡ªå®šä¹‰é€»è¾‘
    if (event.url.url.includes("github.com")) {
        log("info", "æ£€æµ‹åˆ°GitHub URL", "my_plugin");
    }
});

// æ·»åŠ è‡ªå®šä¹‰è·¯ç”±
router.get("/api/my-endpoint", function() {
    return {
        success: true,
        message: "æˆ‘çš„æ’ä»¶è¿è¡Œæ­£å¸¸",
        timestamp: new Date().toISOString()
    };
});

// æ·»åŠ å®šæ—¶ä»»åŠ¡
cron("cleanup_task", "0 2 * * *", function() {
    log("info", "æ‰§è¡Œæ¸…ç†ä»»åŠ¡", "my_plugin");
});

log("info", "æ’ä»¶åˆå§‹åŒ–å®Œæˆ", "my_plugin");</code></pre>
        </div>
      </section>

      <!-- å‹ç¼©åŒ…æ’ä»¶å¼€å‘ -->
      <section>
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-3 flex items-center">
          <i class="fas fa-file-archive text-cyan-500 mr-2"></i>
          å‹ç¼©åŒ…æ’ä»¶å¼€å‘
        </h3>
        <div class="bg-cyan-50 dark:bg-cyan-900/20 border border-cyan-200 dark:border-cyan-800 rounded-lg p-4">
          <p class="text-sm text-gray-700 dark:text-gray-300 mb-4">
            å‹ç¼©åŒ…æ’ä»¶å…è®¸åˆ›å»ºæ›´å¤æ‚çš„å¤šæ–‡ä»¶æ’ä»¶ï¼ŒåŒ…å«å¤šä¸ª JavaScript æ–‡ä»¶ã€é…ç½®æ–‡ä»¶ã€é™æ€èµ„æºç­‰ã€‚
          </p>

          <h4 class="font-medium text-gray-900 dark:text-white mb-2">å‹ç¼©åŒ…ç»“æ„ç¤ºä¾‹ï¼š</h4>
          <pre class="text-xs bg-gray-100 dark:bg-gray-900 p-3 rounded overflow-x-auto mb-4"><code>my-awesome-plugin.zip
â”œâ”€â”€ package.json              # æ’ä»¶é…ç½®æ–‡ä»¶
â”œâ”€â”€ index.js                  # ä¸»å…¥å£æ–‡ä»¶
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ utils.js             # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ processor.js         # æ•°æ®å¤„ç†å™¨
â”‚   â””â”€â”€ validator.js         # éªŒè¯å™¨
â”œâ”€â”€ config/
â”‚   â””â”€â”€ default.json         # é»˜è®¤é…ç½®
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ icon.png             # æ’ä»¶å›¾æ ‡
â”‚   â””â”€â”€ styles.css           # æ ·å¼æ–‡ä»¶
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ email.html           # é‚®ä»¶æ¨¡æ¿
â””â”€â”€ README.md                # è¯´æ˜æ–‡æ¡£</code></pre>

          <h4 class="font-medium text-gray-900 dark:text-white mb-2">package.json é…ç½®ç¤ºä¾‹ï¼š</h4>
          <pre class="text-xs bg-gray-100 dark:bg-gray-900 p-3 rounded overflow-x-auto mb-4"><code>{
  "name": "my-awesome-plugin",
  "version": "1.0.0",
  "description": "ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„æ’ä»¶",
  "main": "index.js",
  "author": "å¼€å‘è€…å§“å",
  "license": "MIT",
  "keywords": ["plugin", "automation", "utility"],
  "engines": {
    "urldb": ">=1.0.0"
  },
  "config": {
    "webhook_url": {
      "type": "string",
      "label": "Webhook URL",
      "default": "https://hooks.slack.com/...",
      "description": "é€šçŸ¥å‘é€çš„Webhookåœ°å€"
    },
    "enable_notifications": {
      "type": "boolean",
      "label": "å¯ç”¨é€šçŸ¥",
      "default": true
    },
    "retry_count": {
      "type": "number",
      "label": "é‡è¯•æ¬¡æ•°",
      "default": 3,
      "min": 1,
      "max": 10
    }
  },
  "dependencies": {},
  "permissions": [
    "network",
    "storage"
  ]
}</code></pre>

          <h4 class="font-medium text-gray-900 dark:text-white mb-2">å‹ç¼©åŒ…æ’ä»¶ä¼˜åŠ¿ï¼š</h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <div class="bg-white dark:bg-gray-800 rounded p-3">
              <h5 class="font-medium text-gray-900 dark:text-white mb-1">ğŸ“ æ¨¡å—åŒ–å¼€å‘</h5>
              <p class="text-xs text-gray-600 dark:text-gray-400">å¯ä»¥å°†ä»£ç æ‹†åˆ†ä¸ºå¤šä¸ªæ¨¡å—ï¼Œä¾¿äºç»´æŠ¤å’Œæµ‹è¯•</p>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded p-3">
              <h5 class="font-medium text-gray-900 dark:text-white mb-1">ğŸ¨ èµ„æºç®¡ç†</h5>
              <p class="text-xs text-gray-600 dark:text-gray-400">å¯ä»¥åŒ…å«å›¾æ ‡ã€æ ·å¼ã€æ¨¡æ¿ç­‰é™æ€èµ„æº</p>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded p-3">
              <h5 class="font-medium text-gray-900 dark:text-white mb-1">âš™ï¸ é…ç½®çµæ´»</h5>
              <p class="text-xs text-gray-600 dark:text-gray-400">é€šè¿‡ package.json å®šä¹‰å¤æ‚çš„é…ç½®é€‰é¡¹</p>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded p-3">
              <h5 class="font-medium text-gray-900 dark:text-white mb-1">ğŸ”§ ä¾èµ–ç®¡ç†</h5>
              <p class="text-xs text-gray-600 dark:text-gray-400">æ”¯æŒæ¨¡å—é—´çš„ä¾èµ–å…³ç³»å’Œä»£ç å¤ç”¨</p>
            </div>
          </div>
        </div>
      </section>

      <!-- å¯ç”¨API -->
      <section>
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-3 flex items-center">
          <i class="fas fa-cogs text-orange-500 mr-2"></i>
          å¯ç”¨ API
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4">
            <h4 class="font-medium text-gray-900 dark:text-white mb-2">æ—¥å¿—å‡½æ•°</h4>
            <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
              <li><code class="bg-gray-200 dark:bg-gray-700 px-1 rounded">log(level, message, pluginName)</code> - è®°å½•æ—¥å¿—</li>
              <li>level: "debug", "info", "warn", "error"</li>
              <li>æ—¥å¿—ä¼šä¿å­˜åˆ°æ•°æ®åº“ï¼Œå¯åœ¨ç®¡ç†ç•Œé¢æŸ¥çœ‹</li>
            </ul>
          </div>

          <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4">
            <h4 class="font-medium text-gray-900 dark:text-white mb-2">è·¯ç”±å‡½æ•°</h4>
            <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
              <li><code class="bg-gray-200 dark:bg-gray-700 px-1 rounded">router.get(path, handler)</code></li>
              <li><code class="bg-gray-200 dark:bg-gray-700 px-1 rounded">router.post(path, handler)</code></li>
              <li><code class="bg-gray-200 dark:bg-gray-700 px-1 rounded">router.put(path, handler)</code></li>
              <li><code class="bg-gray-200 dark:bg-gray-700 px-1 rounded">router.delete(path, handler)</code></li>
            </ul>
          </div>

          <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4">
            <h4 class="font-medium text-gray-900 dark:text-white mb-2">å®šæ—¶ä»»åŠ¡</h4>
            <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
              <li><code class="bg-gray-200 dark:bg-gray-700 px-1 rounded">cron(name, schedule, handler)</code></li>
              <li>schedule: Cron è¡¨è¾¾å¼ (å¦‚ "*/5 * * * *")</li>
              <li>æ”¯æŒæ ‡å‡† Cron æ ¼å¼</li>
            </ul>
          </div>

          <div class="bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-lg p-4">
            <h4 class="font-medium text-gray-900 dark:text-white mb-2">é…ç½®ç®¡ç†</h4>
            <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
              <li><code class="bg-gray-200 dark:bg-gray-700 px-1 rounded">getPluginConfig(name)</code> - è·å–é…ç½®</li>
              <li>é€šè¿‡ JSDoc @config å®šä¹‰é…ç½®å­—æ®µ</li>
              <li>æ”¯æŒå¤šç§å­—æ®µç±»å‹å’ŒéªŒè¯</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- äº‹ä»¶å¯¹è±¡è¯¦æƒ… -->
      <section>
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-3 flex items-center">
          <i class="fas fa-object-group text-indigo-500 mr-2"></i>
          äº‹ä»¶å¯¹è±¡è¯¦æƒ…
        </h3>
        <div class="space-y-3">
          <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4">
            <h4 class="font-medium text-gray-900 dark:text-white mb-2">onURLAdd äº‹ä»¶å¯¹è±¡</h4>
            <pre class="text-xs bg-gray-100 dark:bg-gray-900 p-2 rounded overflow-x-auto"><code>{
    url: {
        id: 156696,
        title: "URLæ ‡é¢˜",
        url: "https://example.com",
        description: "æè¿°",
        category_id: 1,
        tags: ["æ ‡ç­¾1", "æ ‡ç­¾2"],
        is_valid: true,
        is_public: true,
        view_count: 0,
        created_at: "2025-12-29T23:49:04.556Z"
    },
    app: {
        name: "URLDB",
        version: "1.0.0"
    }
}</code></pre>
          </div>

          <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4">
            <h4 class="font-medium text-gray-900 dark:text-white mb-2">onUserLogin äº‹ä»¶å¯¹è±¡</h4>
            <pre class="text-xs bg-gray-100 dark:bg-gray-900 p-2 rounded overflow-x-auto"><code>{
    user: {
        id: 1,
        username: "admin",
        email: "admin@example.com",
        role: "admin",
        is_active: true,
        last_login: "2025-12-29T23:49:04.556Z",
        created_at: "2025-12-29T23:49:04.556Z"
    },
    data: {
        ip: "127.0.0.1",
        user_agent: "æµè§ˆå™¨ä¿¡æ¯",
        login_time: "2025-12-29T23:49:04.556Z"
    },
    app: {
        name: "URLDB",
        version: "1.0.0"
    }
}</code></pre>
          </div>
        </div>
      </section>

      <!-- æœ€ä½³å®è·µ -->
      <section>
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-3 flex items-center">
          <i class="fas fa-lightbulb text-yellow-500 mr-2"></i>
          æœ€ä½³å®è·µ
        </h3>
        <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4">
          <ul class="text-sm text-gray-700 dark:text-gray-300 space-y-2">
            <li class="flex items-start">
              <i class="fas fa-check text-green-500 mr-2 mt-0.5"></i>
              <span>ä½¿ç”¨æè¿°æ€§çš„æ’ä»¶åç§°å’Œå‡½æ•°å</span>
            </li>
            <li class="flex items-start">
              <i class="fas fa-check text-green-500 mr-2 mt-0.5"></i>
              <span>åˆç†ä½¿ç”¨æ—¥å¿—çº§åˆ«ï¼Œä¾¿äºè°ƒè¯•å’Œç›‘æ§</span>
            </li>
            <li class="flex items-start">
              <i class="fas fa-check text-green-500 mr-2 mt-0.5"></i>
              <span>é”™è¯¯å¤„ç†è¦å®Œå–„ï¼Œé¿å…æ’ä»¶å¼‚å¸¸å½±å“ç³»ç»Ÿ</span>
            </li>
            <li class="flex items-start">
              <i class="fas fa-check text-green-500 mr-2 mt-0.5"></i>
              <span>å®šæ—¶ä»»åŠ¡æ‰§è¡Œæ—¶é—´ä¸å®œè¿‡é•¿</span>
            </li>
            <li class="flex items-start">
              <i class="fas fa-check text-green-500 mr-2 mt-0.5"></i>
              <span>æ’ä»¶è·¯ç”±ä½¿ç”¨æœ‰æ„ä¹‰çš„å‰ç¼€ï¼Œé¿å…å†²çª</span>
            </li>
            <li class="flex items-start">
              <i class="fas fa-check text-green-500 mr-2 mt-0.5"></i>
              <span>æä¾›è¯¦ç»†çš„æ’ä»¶æè¿°å’Œé…ç½®è¯´æ˜</span>
            </li>
          </ul>
        </div>
      </section>

      <!-- è°ƒè¯•æŠ€å·§ -->
      <section>
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-3 flex items-center">
          <i class="fas fa-bug text-red-500 mr-2"></i>
          è°ƒè¯•æŠ€å·§
        </h3>
        <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4">
          <ul class="text-sm text-gray-700 dark:text-gray-300 space-y-2">
            <li class="flex items-start">
              <i class="fas fa-tools text-red-500 mr-2 mt-0.5"></i>
              <span>ä½¿ç”¨ <code class="bg-gray-200 dark:bg-gray-700 px-1 rounded">log("debug", message, pluginName)</code> è®°å½•è°ƒè¯•ä¿¡æ¯</span>
            </li>
            <li class="flex items-start">
              <i class="fas fa-tools text-red-500 mr-2 mt-0.5"></i>
              <span>åœ¨æ’ä»¶ç®¡ç†ç•Œé¢æŸ¥çœ‹å®æ—¶æ—¥å¿—è¾“å‡º</span>
            </li>
            <li class="flex items-start">
              <i class="fas fa-tools text-red-500 mr-2 mt-0.5"></i>
              <span>æ’ä»¶æ”¯æŒçƒ­é‡è½½ï¼Œä¿®æ”¹åè‡ªåŠ¨ç”Ÿæ•ˆ</span>
            </li>
            <li class="flex items-start">
              <i class="fas fa-tools text-red-500 mr-2 mt-0.5"></i>
              <span>å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯æ’ä»¶åŠŸèƒ½</span>
            </li>
            <li class="flex items-start">
              <i class="fas fa-tools text-red-500 mr-2 mt-0.5"></i>
              <span>å‹ç¼©åŒ…æ’ä»¶å¯ä»¥é€šè¿‡è§£å‹æŸ¥çœ‹æ–‡ä»¶ç»“æ„è¿›è¡Œè°ƒè¯•</span>
            </li>
          </ul>
        </div>
      </section>
    </div>

    <template #footer>
      <div class="flex justify-between">
        <n-button @click="goToPluginManager" type="info" v-if="showPluginManagerButton">
          <template #icon>
            <i class="fas fa-plug"></i>
          </template>
          å‰å¾€æ’ä»¶ç®¡ç†
        </n-button>
        <div></div>
        <n-button @click="closeModal" type="primary">
          æˆ‘çŸ¥é“äº†
        </n-button>
      </div>
    </template>
  </n-modal>
</template>

<script setup lang="ts">
interface Props {
  modelValue: boolean
  showPluginManagerButton?: boolean
}

const props = withDefaults(defineProps<Props>(), {
  showPluginManagerButton: true
})

const emit = defineEmits<{
  'update:modelValue': [value: boolean]
  'go-to-plugin-manager': []
}>()

const visible = computed({
  get: () => props.modelValue,
  set: (value) => emit('update:modelValue', value)
})

const closeModal = () => {
  emit('update:modelValue', false)
}

const goToPluginManager = () => {
  emit('go-to-plugin-manager')
  closeModal()
}
</script>